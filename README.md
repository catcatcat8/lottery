# lottery-token

## Описание проекта
- Смарт-контракт-лотерея, в которой шансы на выигрыш пропорциональны вашим купленным лотерейным билетам
- За вложенный эфир в контракт вы получаете TrueLotteryCoins: 1 ETH = 100 TLC
- TLC можно свободно обменивать между владельцами, допускаются все функции стандартного ERC20 токена
- Стоимость одного лотерейного билета: 1 TLC
- Нет общего ограничения на число купленных билетов, но только 200 можно купить за один раз
- Заплатив за один билет, вы прибавляете общий счетчик ваших билетов, ваш шанс сорвать куш равен доле купленных вами лотерейных билетов
- Все ваши TLC можно свободно вывести в ETH на ваш аккаунт в любой момент

## Как выиграть
Для того, чтобы выиграть, Вам нужно купить как минимум один лотерейный билет в любой лотерее и надеяться на удачу. Вероятность выигрыша увеличивается с количеством купленных билетов и равна количеству купленных вами билетов, поделенных на общее количество билетов, участвующих в розыгрыше.

После стадии приобретения билетов будет оглашено имя победителя, общий пул собранных токенов за стадию приобретения билетов будет перечислен на аккаунт победителя.

## Фазы лотереи

Каждая сессия лотереи завершается за ~ 1 час 10 минут

### Фаза 1. Приобретение билетов
- У вас есть один час, чтобы купить лотерейные билеты
- Джекпот лотереи в токенах складывается из общего числа приобретенных билетов
- Вы получаете 1 лотерейный билет за заплаченный 1 TLC

### Фаза 2. Приостановление приобретения билетов
- Фаза наступает, если хотя бы 2 билета было куплено и 1 час прошел
- Фаза длится ~ 5 минут
- За это время вы можете посмотреть всех игроков, ваши шансы на выигрыш, ваши купленные билеты

### Фаза 3. Определение победителя
- Определяется выигрышный билет, оглашается адрес победителя
- Общая сумма разыгранных токенов за исключением одного (комиссия) переводится на счет победителю
- Все игроки могут посмотреть, кто выиграл
- Следующая лотерея стартует примерно через 5 минут

## Как определяется выигрышный билет
Лотерея стремится быть полностью случайной (сохраняя пропорциональность шансов количеству вложенных билетов). Несмотря на то, что выдаваемые номера билетов определяются логикой контракта, вероятность того, что кто-либо сможет заранее определить выигрышный номер, крайне мала.

## Доступные view-функции для игроков на любой стадии лотереи
- Просмотр всех игроков, участвующих (или участвовавших когда-либо) в любой лотерее
- Просмотр количества купленных Вами (или кем-либо) билетов в любой лотерее
- Просмотр общего количества токенов, разыгрывающихся в любой лотерее
- Просмотр шансов на выигрыш (округленные в меньшую сторону процентах) любого игрока в любой лотерее
- Просмотр номера текущей лотереи
- Просмотр статуса любой лотереи
- Просмотр победителя любой лотереи

## Сборка проекта

### Установка ganache-cli (пропустите этот шаг, если уже установлено)

Удостоверьтесь, что вы имеете Node.js (>= v8) установленным.

Используя npm:

```Bash
npm install -g ganache-cli
```

### Установка brownie (пропустите этот шаг, если уже установлено)

Удостоверьтесь, что вы имеете python3 (>= 3.6) установленным.

Используя pipx:

```bash
python3 -m pip install --user pipx
python3 -m pipx ensurepath
pipx install eth-brownie
```

## Компиляция проекта

Чтобы скомпилировать контракт:

```bash
brownie compile
```

## Деплой

Деплой контракта в локальную тестовую сеть Ganache:

```bash
brownie run deploy.py
```

## Тесты

Запуск тестов контракта:

```bash
brownie test
```
